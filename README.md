# Тема работы:
Разработка системы автоматической генерации тестов для задач по спортивному программированию с учётом настроек пользователя

# Use case
## AS IS
![asis](/assets/asis.png)

## Use case diagram
![components](/assets/useCase.png)

## Требования
1. Пользователь должен иметь возможность посмотреть все задачи, отфильтровывать задачи,
а также добавить, посмотреть, изменить, удалить одну задачу.
2. Пользователь должен иметь возможность посмотреть и удалить все тесты, сгенерировать и экспортировать тесты, а также
добавить, посмотреть, изменить и удалить один тест.

# Архитектура
Используется микросервисная архитектура. При этом: 
## Диаграмма компонентов
![components](/assets/componentDiagram.png)

## Компоненты:
1. ***API-Gateway*** – единая точка входа.
2. ***Service Registry*** – реестр микросервисов.
3. ***Web-Client*** – веб-приложение (основной UI).
4. ***Export-service*** – микросервис для экспорта тестов.
5. ***Generator-service*** – микросервис для генерации тестов.
6. ***Parser-service*** – микросервис для обработки задач.
7. ***Generator-Lib*** – библиотека для генерации тестов.
8. ***Parser-Lib*** – библиотека для обработки задач.
9. ***Logging-Serivce*** – сбор, хранение и визуализация логов.

## Хранилища данных:
1. ***Реляционная СУБД*** – для структурированных данных
2. ***Документо-ориентированная хранилище*** – для обработанных задач.

## Способы взаимодействия:
1. ***Синхронный*** – HTTP протоколы.
2. ***Асинхронный*** – брокер сообщений.

## Процесс генерации тестов
![seq](/assets/sequenceDiagram.png)

# Хранилища данных
## Реляционное хранилище
![er](/assets/er.png)
## Документо-ориентированное хранилище
Для хранения свойств задач была разработана специальная [классификация](/parser-lib/docs/enums/props/props.md) и классы.
![docs](/assets/classDiagram.png)

# Генерация тестов
Этап генерации тестов был разделен на два этапа:
1. Выделение ключевых свойств задачи (получение схемы/конфигурации задачи) на основе регулярных выражений (Parser-Lib).
2. Генерация тестов на основе выделенной схемы задачи (Generator-Lib).

## Алгоритм выделения схемы
Алгоритм разбивается на следующие шаги:
1. Нормализация текста.
2. Выделение ключевых конструкций.
3. Выделение переменных и их ОДЗ.
4. Упорядочивание переменных.
![pars-alg](/assets/activity-parsing.png)
## Алгоритм генерации тестов
Алгоритм разбивается на следующие шаги:
1. Получение генератора случайных чисел.
2. Определение типа теста.
3. Генерация теста.
4. Агрегирование тестов.
![gen-alg](/assets/activity-generator.png)

# Реализация
## Web-Client
Пользовательский интерфейс (Web-Client) представляет собой веб-приложение,
которое позволяет пользователям взаимодействовать с системой. 

| Технология         | Назначение в системе                                                                 |
|--------------------|-------------------------------------------------------------------------------------|
| Java               | Основной язык реализации логики микросервиса Web-Client                             |
| Spring Boot        | Построение серверной части; реализация архитектуры MVC                              |
| Thymeleaf          | Генерация HTML-интерфейсов с динамическими данными                                  |
| Spring Security    | Аутентификация и авторизация пользователей                                          |
| JWT (JSON Web Token) | Формирование и хранение токена доступа в Cookie (HTTP-only)                       |
| BCrypt             | Безопасное хеширование паролей пользователей                                        |
| Spring Data JPA    | Работа с реляционной БД PostgreSQL                                                  |
| Liquibase          | Управление версионностью схемы базы данных                                          |
| Kafka              | Асинхронная отправка сообщений при генерации тестов                                |
| API Gateway        | Централизованная маршрутизация и проксирование запросов к внутренним сервисам      |
| PostgreSQL         | Хранение задач и тестов, созданных пользователями                                  |
## Parser-Service
Сервис парсинга задач — это ключевой компонент, отвечающий за извлечение структуры задач из текстового описания и
сохранение этой структуры в базе данных. Он анализирует текст задачи, извлекает параметры и создает схему для дальнейшей
генерации тестов.

| Технология       | Назначение в системе                                                                 |
|------------------|-------------------------------------------------------------------------------------|
| Java             | Основной язык реализации логики микросервиса                                        |
| Spring Boot      | Построение микросервисной архитектуры, конфигурация и точка входа                  |
| Apache Kafka     | Получение и отправка сообщений о генерации и готовности схем                       |
| Spring Data JPA  | Доступ к задачам в реляционной базе PostgreSQL                                     |
| PostgreSQL       | Хранение описаний задач и метаданных                                               |
| MongoDB          | Хранение извлечённых схем входных данных                                           |
| parser-lib       | Библиотека парсинга: извлечение схемы из текстового описания задачи               |
| Jackson          | Сериализация и десериализация JSON-сообщений и документов                         |
## Generator-Service
Сервис генерации тестов выполняет основную задачу системы — на основе схемы задачи, переданной от сервиса парсинга,
генерирует тестовые случаи. Эти тесты затем могут быть использованы для проверки решений участников спортивного программирования.

| Технология      | Назначение в системе                                                                 |
|-----------------|-------------------------------------------------------------------------------------|
| Java            | Основной язык реализации микросервиса                                               |
| Spring Boot     | Базовая платформа сервиса; настройка компонентов, точка входа                       |
| Apache Kafka    | Получение уведомлений о готовности схем                                             |
| Jackson         | Сериализация и десериализация Kafka-сообщений                                       |
| Spring Data JPA | Доступ к PostgreSQL для извлечения задач и сохранения тестов                        |
| PostgreSQL      | Хранение задач и сгенерированных тестов                                             |
| MongoDB         | Получение схем задач                                                                |
| generator-lib   | Библиотека генерации тестов на основе схемы задачи                                  |
## Export-Service
Этот компонент предоставляет функциональность для экспорта сгенерированных тестов.

| Технология      | Назначение в системе                                                                 |
|-----------------|-------------------------------------------------------------------------------------|
| Java            | Язык реализации микросервиса                                                        |
| Spring Boot     | Создание REST-контроллеров, обработка HTTP-запросов, настройка приложения           |
| API Gateway     | Централизованная маршрутизация запросов к сервису                                   |
| PostgreSQL      | Хранение задач и сгенерированных тестов, доступ к которым осуществляется при экспорте|
| Spring Data JPA | Извлечение тестов и задач из БД                                                     |
## API-Gateway и Eureka-Server

| Компонент      | Назначение                                                                         |
|----------------|------------------------------------------------------------------------------------|
| Eureka-Server  | Централизованный реестр сервисов. Отслеживает доступность и адреса микросервисов  |
| API-Gateway    | Единая точка входа. Перенаправляет внешние HTTP-запросы к нужным микросервисам    |
# Generator-Lib и Parser-Lib
Для упрощения разработки и обеспечения повторного использования логики были выделены две отдельные библиотеки — 
Generator-Lib и Parser-Lib. Parser-Lib отвечает за извлечение структуры задачи из текстового описания, а
Generator-Lib — за генерацию тестов на основе этой структуры. Эти библиотеки являются независимыми модулями,
которые могут быть использованы как внутри системы, так и отдельно.  

Текущая версия поддерживает следующие конструкции:
1. Мультитесты и обычные тесты.
2. Одиночная целочисленная переменная на строке.
3. Массив целых случайных чисел фиксированной длины.
## Интеграция с Kafka
В системе для обеспечения асинхронного взаимодействия между микросервисами используется Apache Kafka.
Для развертывания Kafka и необходимых компонентов, применяется технология контейнеризации Docker.

| Топик             | Producer       | Consumer           | Событие                          |
|-------------------|----------------|--------------------|----------------------------------|
| generate-tests    | Web-Client     | Parser-Service     | Запрос генерации схемы           |
| schema-ready      | Parser-Service | Generator-Service  | Уведомление о готовности схемы   |
## Интеграция с ELK
Для мониторинга и отладки распределённой микросервисной системы в проекте была реализована централизованная система
логирования, основанная на стеке ELK. Логирующая подсистема развёрнута в изолированной среде с использованием Docker.

| Компонент                 | Назначение                                                                 |
|---------------------------|---------------------------------------------------------------------------|
| Elasticsearch             | Хранение логов, поддержка полнотекстового поиска                          |
| Logstash                  | Получение логов по TCP, преобразование и отправка в Elasticsearch         |
| Kibana                    | Веб-интерфейс для визуального анализа, фильтрации и поиска логов          |
| logstash-logback-encoder  | Сериализация логов в JSON для передачи в Logstash                         |
| logback-spring.xml        | Конфигурация логирования микросервисов, настройка каналов вывода логов    |
## Организация процесса разработки и тестирования
Для разработки системы использовались DevOps-подходы, что обеспечило эффективное управление кодом и автоматизацию процессов

| Инструмент / Метод       | Назначение                                                                 |
|--------------------------|---------------------------------------------------------------------------|
| Git + GitHub             | Контроль версий, хостинг репозитория                                      |
| Именование веток         | dev/ci, dev/front, и т.д. для структурированной работы                    |
| Префиксы коммитов        | feat, fix, ref, test - улучшение читаемости истории                       |
| Pull requests (11 шт.)   | Ревью и поэтапная интеграция изменений                                    |
| GitHub Actions           | Автоматическая сборка и тестирование при push / PR                        |